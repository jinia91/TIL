# 3. 모델과 구현의 연계

> 기능성은 갖췄지만 매우 비대하고 이해하기 어려움 => 유지보수가 불가능

- 코드를 통해 시스템의 목적에 관해 통찰력을 얻을수 있어야함

- DDD를 하면 초기 분석단계뿐 아니라 설계의 기반이 되는 모델링도 가능
-

## Model Driven Design

- 분석 모델과 설계를 구분하지 않는 방식
- 각 객체는 모델에서 기술한 개념적 역할을 수행
- 모델은 구현의 요소를 어느정도는 고려해야하며, 지나치게 타협된 상태로 두어서는 안됨
- `모델링과 설계는 하나의 순환고리`
- 도메인 모델을 설계와 밀접하게 연관시키는 원칙
- 수차례의 반복주기와 상당량의 리팩토링이 필수, 관련성있는 모델을 만들수가 있음


> 설계시 있는 그대로의 도메인 모델을 그대로 반영하여 설계와 모델의 대응을 분명히 하고 모델을 재검토해서 더욱 자연스럽게 소프트웨어로 구현될수 있게 고려할 것

그리고 해당 모델을 구현으로 그대로 실현함에 있어서 객체지향 프로그래밍과같은 패러다임과 지원 프레임워크, 라이브러리의 도움을 받자
 


> 개발은 모델, 설계, 코드를 단일한 활동으로 정제하는 반복적인 과정!


## Hands-On Modeler

- 모델러와 코더를 구분짓는 개발 방식은 DDD와 어울리지 않음
- 폭포수 개발방식속의 모델러와 개발자 구분방식에 대한 비판
- 코드의 변경이 곧 모델의 변경임을 인식할것
> 개발은 모델, 설계, 코드를 단일한 활동으로 정제하는 반복적인 과정!
- 만약 모델러가 구분되어 있다면, 모델러는 코드를 파악해야하고, 코드를 통해 모델을 표현하는법 역시 알아야한다. 반대로 개발자도 도메인 전문가와 일정수준의 토의에 깊이 관여해야하고 지속적으로 접촉해야한다.

# 4. 도메인의 격리

- 전체 소프트웨어 앱 안에서 비즈니스의 관심사, 비즈니스 로직은 코드레벨에서 보면 작은 부분이며, 이러한 도메인로직들은 도메인안에서 이루어져야하고, 기술적인 코드와 분리되어야만 하나의 큰 시스템에서 비즈니스 로직에만 집중할수 있다.

- 이러한 도메인로직의 격리를 위한 방법이 바로 아키텍처

## 계층형 아키텍처

- 원칙적으로 비즈니스 객체안에서는 사용자 인터페이스를 위한 코드, 데이터베이스를 위한 코드, 기타 보조적인 코드는 존재해서는 안됨
- 도메인과 관련된 코드가 도메인과 관련이 없는 다른 코드를 통해 널리 확산될경우 도메인에 관련된 코드를 확인하고 추론하기 어려워짐
- e.g) 
    - UI를 표면적으로 변경하고자하는일이 비즈니스 로직의 변경으로 전파되는것이 대표적인 잘못된 구조의 예시
    - 반대로 비즈니스로직을 변경함이 UI나 데이터베이스 코드에 전파되는것도 반대 예시
 > `Separation of concern`


|  |  |
| --- | --- |
| interface | 사용자에게 정보를 보여주고 명령을 해석하는 일 |
|  application | 소프트웨어가 수행할 작업을 정의하고 표현력있는 도메인객체가 문제를 해결하게한다(도메인을 오케스트레이션), 따라서 이 계층은 얇게 유지되어야하고, 업무규칙이나 지식이 포함되지 않으며, 오직 작업을 조정하고 아래에 위차한 계층에 포함된 도메인객체의 협력자에게 작업을 위임 |
|  domain | 업무 개념과 업무상황에 관한 정보, 업무 규칙을 표현하는일을 책임지고 기술적인 세부사항은 인프라스트럭처에 위임 |
| infra | 기술적 기능의 제공 |


- 핵심은 application 레이어가 얇게 유지된다는 점

- 상위 계층은 하위계층으로만, 단방향으로 의존관계가 흘러야함
- 만약 하위계층이 상위계층과 소통해야하는경우라면 콜백이나 관찰자 패턴처럼 계층간 관계를 맺어주는 아키텍처 패턴을 사용해야함
    - eg. 하위계층인 인프라스트럭쳐, 데이터가 변화했을때 이를 pub하는 화면단에서 변화가 일어나는 방식(관찰자 패턴과 유사?)
    
### MVC와 application, domain, presentation
70" MVC 패턴에서 DDD를 접목하면
- controller => controller, model => domain, view => presentation
- 문제는 해당방식으로는 `controller`가 `domain`을 제대로 오케스트레이션하지 못함!



> `Model View Separation Pattern` - Larman(1998)

=> **Application Coordinator**

- 핵심은 도메인 계층을 격리해서 해당 도메인 객체를 설계할 때, 동시에 사용자 인터페이스도 생각할 필요가 없게 만드는 것! 도메인과 프리젠테이션의 격리


application 레이어는 이메일을 `언제` 보내는지는 알아도, `어떻게` 보내는지는 알아서는 안된다!


### 소고
DDD의 저작 시점이 2000년대 초반이고, 당시는 스프링이 나오지않고 프레임워크들이 난립하던 시기라서 현대적인 프레임워크에서 이미 적용되고 사용하고 있는, 당연하다고 느끼는 다양한 개념들이 마치 새로운 개념인것처럼,
사용되지 않고 있다는것처럼 저술되어있다. 
