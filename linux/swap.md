# swap영역
> 물리메모리가 부족할 경우를 대비해서 만들어 놓은 영역

디스크의 일부분을 메모리처럼 사용하기때문에 성능상 문제

머신에 swap이 발생할경우, 어떤 프로세스가 swap을 사용하느냐도 매우 중요한 판단기준!

## proc 디렉토리

> 프로세스 정보 등 커널 관련 정보가 저장되는 디렉터리이다.

|File/Directory|comment|
|-|-|
|/proc/[PID]/maps	|프로세스가 mapping 된 메모리 주소 공간을 보여줌. 모든 프로세스에는 각자 주소 공간이 있으며, 이 주소 공간은 가상 메모리 관리자(Virtual Memory Manager)가 제공하고 관리|
|/proc/[PID]/smaps|이 파일은 /proc/[pid]/maps에서 제공하는 정보에 더하여, 각 메모리 매핑에 대한 추가적인 세부 정보를 제공|
|/proc/[PID]/cmdline	|프로세스 인수(argv) 전체를 포함. Command Line에서 넘어온 argumnet를 포함하여 프로세스가 질생된 방식을 정확하고 신속하게 파악하는 수단으로 사용|
|/proc/[PID]/coredump_filter	|메모리 유형의 비트마스크를 포함하며 프로세스의 어떤 메모리 세그먼트를 덤프시킬 것인지 설정 |
|/proc/[PID]/cwd/	|프로세스가 사용중인 디렉토리나 파일|
|/proc/[PID]/environ	|프로세스의 현재 환경을 저장. 프로세스 map에서 가장 아랫부분, 즉 커널이 프로세스 환경 정보를 저장하는 메모리 위치를 직접 가리키는 링크이다. 프로그램 실행 중 환경 변수 설정을 알고 싶을 때 이 파일을 확인하면된다.|
|/proc/[PID]/exe	|	실행중인 프로그램 이름|
|/proc/[PID]/fd, /proc/[PID]/fdinfo|프로세스가 사용중인 File Descriptor 링크와 정보 저장|
|/proc/[PID]/limits	|	프로세스에 적용된 resource 제한 사항|
|/proc/[PID]/loginuid|해당 프로세스를 실행하는 login UID|
|/proc/[PID]/mem|프로세스가 사용중인 메모리 상태|
|/proc/uptime|시스템 가동 시간에 대한 정보를 기록한다.|
|/proc/meminfo|물리적 메모리 및 스왑 메모리 정보가 들어 있는 파일이다.|
|/proc/cmdline|부팅 시에 실행되는 커널 관련 옵션에 대한 정보를 담고 있다.|
|/proc/loadavg|최근 1분, 5분. 15분 동안의 평균 부하율을 기록하는 파일이다.|

- 여기서 smap으로 찾아가 어능여역이 swap에 해당하는지 확인 가능!
- status나 smem 를 통해서도 확인가능


## 버디시스템?

> 외부 단편화를 해소하기위한 솔루션 ! 리눅스 커널에서 사용되는 메모리 할당 알고리즘

### 외부 단편화란?

커널이 연속적인 페이지 프레임 그룹의 할당 해제를 반복하는 동안 페이지 프레임 블록 사이에 작은 여유 페이지 프레임 여러개가 산재하는 현상

반복되다보면 여유공간 총량은 남아도 할당이 안되는 상황이 발생...

### Sol?

1. 페이징 회로를 활용하여 불연속적인 여유 페이지 프레임의 그룹을 연속된 가상 주소 구간에 매핑
2. 남아있는 연속된 여유 페이지 프레임 블록을 관리하는 적절한 기법을 개발하여, 작은 블록을 요청할 때 큰 여유 블록을 쪼개서 할당하는 경우를 가능한 줄이기

> 여기서 2번 솔루션이 바로 버디시스템!

1번은 가상 주소로 요청을 처리할 수 없고, 실제로 연속된 페이지 프레임이 필요한 케이스들이 있어 핸들링이 어렵다...


### 버디시스템 알고리즘은?

1. 사용하지 않는 모든 페이지 프레임을 1단위, 2단위, 2^2단위, 2^3단위... 2^10단위까지 그룹을 지어 리스트에 담는다.
2. 만약 18kb 연속된 프레임의 메모리할당이 필요할경우 리눅스 커널은 기본 4kb가 하나의 프레임이므로 3프레임이 필요하다.
3. 따라서 3프레임을 할당할 수 있는 가장 작은 그룹(2^2단위)에서 먼저 여유공간을 탐색한다.
4. 그러나 만약 해당 그룹에서 여유공간이 없을경우 다음 상위그룹인 2^3그룹에서 여유공간을 찾는다.
5. 재귀적으로 행하면서 가장 적절한 최소 그룹에 할당하여 추후 해제시 단편화될 공간을 최소화하려한다.
> 약간의 외부 단편화, 오버헤드는 어쩔수없다...

### 버디시스템을 리눅스에서 보기

> /proc/buddyinfo

<img width="803" alt="image" src="https://github.com/jinia91/TIL/assets/85499582/2a955918-d07b-4554-b921-e633d4e87c84">

각 컬럼은 1프레임, 2프레임, 4프레임...1024프레임을 의미하며
각 행은 zone이라 불리우며, 고유의 관리와 할당정책을 가지고있다.

- DMA (Direct Memory Access) Zone: 이 영역은 직접 메모리 접근이 가능한 물리 메모리 영역입니다. 주로 16MB 이하의 메모리 공간을 포함하며, 예전의 장치와 호환성을 위해 사용
- Normal Zone: 이 영역은 DMA Zone을 제외한 일반적인 물리 메모리 영. 대부분의 시스템 메모리와 사용자 공간 메모리가 이 영역에서 할당
- HighMem Zone: 이 영역은 높은 메모리 영역으로, 커널에서 직접 매핑할 수 없는 메모리 공간을 포함합니다. HighMem Zone은 32비트 시스템에서 4GB 이상의 메모리를 지원하기 위해 사용되며, 64비트 시스템에서는 일반적으로 사용되지 않음






