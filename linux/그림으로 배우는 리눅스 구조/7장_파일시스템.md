## 개요
- 대부분의 저장장치는 디바이스 파일이 아닌 파일 시스템을 사용
- 파일형식으로 데이터를 관리하는 저장장치의 영역(관리영역)과 해당 저장영역을 다루는 처리(커널 모드의 파일시스템코드)를 합쳐서 파일시스템으로 부름
- 파일 시스템에는 데이터와 메타데이터 두종류의 데이터가 존재하며, 메타데이터는 파일을 관리할 목적으로 존재한는 부가적인 정보


## 파일 접근 방법
### 파일 조작
- 작성, 삭제 : creat(), unlink()등
- 열고 닫기 : open(), close()
- 읽고 쓰기 : read(), write(), mmap() 등

### 디렉토리 조작
- 작성, 삭제 : mkdir(), rmdir()
- 현재 디렉터리 변경: chdir()
- 읽기 : readdir() 등

파일시스템의 종류 차이와 상관없이 인터페이스로서 조작 가능하다

### 함수 호출 과정
1. 파일 시스템 조작용 함수가 내부적으로 파일 시스템을 조작하는 시스템콜을 호출
2. 커널 내부 가상파일시스템(VFS) 처리가 동작하고 각각의 파일 시스템 처리를 호출
3. 파일 시스템 처리가 디바이스 드라이버를 호출
4. 디바이스 드라이버가 장치를 조작

## 메모리 맵 파일
- 파일 영역을 가상 주소 공간에 매핑하는 메모리 맵파일 기능이 존재
- 만약 특정 파일을 수정할시 해당 파일을 로드한 메모리에 접근하여 변경하고 나중에 저장장치에 있는 파일에도 반영하는 방식

## 일반적인 파일 시스템
### ext4
- **전신**: ext3
- **특징**:
  - 저널링 파일 시스템으로 데이터 무결성을 보장함.
  - 단일 파일 시스템 크기는 최대 1EB (엑사바이트), 단일 파일 최대 크기는 16TB.
  - 폴더 안에 파일 수에 제한 없음 (이전 버전 ext3는 한 디렉토리 내 파일 수가 32,000개로 제한).
  - Extents를 사용해 대규모 파일을 효율적으로 관리 (파일 조각화 감소).
  - 지연 할당(Delayed Allocation) 기능으로 디스크 쓰기 작업 최적화.
- **적용 사례**: 일반적인 데스크탑 사용, 일부 서버 환경에서 널리 사용.

### XFS
- **특징**:
  - 고성능 64비트 저널링 파일 시스템.
  - 파일 시스템 크기 최대 8EB, 단일 파일 최대 크기는 파일 시스템의 크기와 동일.
  - 메타데이터 저널링을 지원하여 빠른 파일 접근 속도 제공.
  - 병렬 I/O 처리를 효율적으로 지원하여 대규모 파일 시스템에서 뛰어난 성능.
  - 온라인 확장 및 축소 기능 지원.
- **적용 사례**: 대규모 파일 서버, 미디어 스트리밍, 데이터베이스 서버 등에 적합.

### Btrfs
- **특징**:
  - "카피 온  라이트"(copy-on-write) 스냅샷 지원.
  - 데이터 및 메타데이터에 대한 체크섬을 통한 고신뢰성 보장.
  - 동적 인라인, 온라인 볼륨 확장 및 축소, 서브볼륨 관리 등의 기능 제공.
  - RAID 0, RAID 1, RAID 10, RAID 5, RAID 6 구성 지원.
  - SSD 최적화 및 효율적인 디스크 사용을 위한 TRIM/DISCARD 지원.
- **적용 사례**: 서버 및 데스크탑에서 데이터 무결성 및 유연한 스토리지 관리가 중요한 환경.


## 쿼터(옹량제한)
- 사용자 쿼터 : 파일 소유자인 사용자마다 용량을 제한하여 일반 사용자때문에 /home/ 디렉터리가 가득 차는 사태를 방지, (ex4, XFS) 
- 디렉터리 쿼터 : 특정 디렉터리마다 용량을 제한 (ex4, XFS)
- 서브볼륨 쿼터 : 파일 시스템 내부의 서브 볼륨 단위마다 용량을 제한. (Btrfs)

 ## 파일 시스템 정합성 유지
 - 전원이 강제로 끊기는 등의 이유로 파일 시스템 오류가 발생할 수 있음
 - 정합성이 깨진상태에서 마운트 작업을 하면 파일 시스템이 마운트 불가능하거나 읽기 전용모드로 마운트를 하거나 시스템 패닉이 일어남
 - 이러한 정합성 오류를 방지하기 위해 여러 기술이 존재한다.

### 저널링
파일 시스템 ㅐㄴ부에 저널이라는 특수한 메타데이터 영역을 준비하고 저널로그를 통해 트랜잭션 아토믹 단위를 구현

### 카피 온 라이트
- ext4나 XFS는 저장장치에 파일데이털르 썼다면 이후 파일을 갱신할 때는 저장장치의 동일한 위치에 데이터를 써넣음
- 하지만 Btrfs 같은 카피 온 라이트 형식 파일 시스템은 일단 파일에 데이터를 쓴 이후로는 갱신시 다른 장소에 변경된 부분만 다시 데이터를 작성하로 링크
- 처리중 문제가 발생하면 새로 작성한 데이터만 삭제하면 되므로 정합성 유지가 보다 원할함

### 시스템 복구 fsck
- 추천하지 않음
- 정합석 확인 및 복구를 위해 파일 시스템 전체를 검사하므로 매우 오래걸림
- 실패로 끝나는 경우가 많음
- 복구 처리중 에러가 발생하면 복원가능할수 있던 데이터도 삭제될수도...

## Btrfs가 제공하는 파일 시스템의 고급 기능
### 스냅샷
- 데이터를 참조하는 메타 데이터만 새로 작성하는 방식.
- 원본 파일 시스템과 데이터를 공유
- 스냅샷은 결국 대부분의 데이터를 공유하므로 백업용도가 아니라 백업 백그라운드 작업을 위한 용도

### 멀티 볼륨
- ext4나 XFS는 1개의 파티션에 1개의 파일 시스템을 작성
- Btrfs는 여러 저장 장치와 파티션으로 커다란 저장소 풀을 만들어서 거기에 마운트 가능한 서브 볼륨 영역을 작성 - 일종의 볼륨그룹과 논리볼륨
- Btrfs는 한마디로 파일시스템 + 볼륨 매니저인셈

## 데이터 손상 감지와 복구
- 하드웨어 비트 오류 등의 이유로 파일 시스템 데이터가 망가질경우 Btrfs는 손상감지 및 레이드구성을 통한 원상복구가 가능
- Btrfs는 모든 데이터에 체크섬이 있어서 데이터 손상을 감지 가능

## 기타 파일 시스템
### 메모리 기반 파일 시스템
- 저장 장치 대신 메모리를 사용해 작성하는 tmpfs 파일시스템이 존재

### 네트워크 파일 시스템
- 네트워크로 연결된 원격 호스트의 데이터에 파일 시스템 인터페이스를 사용해서 접근하는 방식
- NFS, CIFS는 원격 . 호스트에 있는 파일 시스템을 로컬에 있는 파일 시스템처럼 조작 가능
- 여러 기기의 저장 장치를 하나로 묶어서 커다란 파일 시스템으로 만드는 CephFS같은 파일 시스템도 존재

### procfs

- 현재 실행중인 프로세스 관련 정보를 다루는 파일시스템
- /proc 아래 마운트된다
- /proc/pid 로 접근하면 pid에 대응하는 프로세스 정보를 얻을 수 있음

|파일명|의미|
|-|-|
|maps|프로세스 메모리 맵|
|cmdline|프로세스 명령줄 인수|
|stat|프로세스 상태, 지그까지 사용한 CPU 시간, 우선도, 사용 메모리 용량|
|cpuinfo|시스템에 설치된 CPU 관련 정보|
|diskstat|시스템에 설치된 저장 장치 관련 정보|
|meminfo|시스템 메모리 관련 정보|
|sys/이하 파일들|커널의 각종 튜닝 파라미터, sysctl 명령어와 sysctl.conf로 변경하는 파라미터와 1대1 관계|

os가 제공하는 각종 명령어의 메트릭들이 위의 프로세스 파일들에 기록되는것들

### sysfs
- proc이 남용되지 않도록 커널이 관리하는 잡다한 정보를 모아둔 장소
- /sys/ 디렉터리에 마운트된다
