---


---

<h3 id="매핑시-주의사항">매핑시 주의사항</h3>
<h3 id="enumerated">@Enumerated</h3>
<p>ORDINAL 사용 금지!</p>
<p>EnumType.STRING 이름으로 저장하는게 유지보수에 훨씬 좋음 ORDINAL로하면 위험함</p>
<h3 id="id-생성시-매핑전략-권장사항">ID 생성시 매핑전략 권장사항</h3>
<h4 id="long형--대체키-키-생성전략-사용">LONG형 + 대체키 +키 생성전략 사용</h4>
<p>주민번호니 이런 비지니스차원의 자연수는 절대 사용하지말것!</p>
<h4 id="identity-전략-특징">Identity 전략 특징</h4>
<p>DB에 ID 생성전략을 위임하는방법으로 MYSQL에서 내부 AUTO INCREMENT 사용하는것</p>
<p>이경우 PERSIST 메소드를 할때 영속성 컨텍스트의 캐시에 ID값을 앱단위에서는 알수 없으므로 PERSIST시 바로 INSERT쿼리가 날라가고 아이디값을 반환받아 영속컨텍스트 캐시에 저장하게된다.</p>
<p>메커니즘을 알아두자.</p>
<h4 id="sequence-전략-특징">SEQUENCE 전략 특징</h4>
<p>오라클 시퀸스 객체같은 개념<br>
따라서 DB 시퀸스에 쿼리를 보내서 다음값을 받아와 영속성 컨텍스트에 저장시킴!<br>
즉 IDENTITY전략과 달리 PERSIST시 쿼리가 날라가지 않음</p>
<h4 id="둘다-네트워크를-타기때문에-성능상-이슈가-있을수-있음">둘다 네트워크를 타기때문에 성능상 이슈가 있을수 있음</h4>
<p>Sequence의경우 SequenceGenerator를 통해 AllocationSize를 할당해서 다음 id값들을 미리 캐싱할수 있음! 이때 디비엔 할당 사이즈만큼 미리 시퀸스를 땡겨오므로 동시성에 문제가 생기지 않음!</p>
<h2 id="연관관계-매핑">연관관계 매핑</h2>
<h3 id="다-대-일-매핑에서-연관관계-주인정하기">다 대 일 매핑에서 연관관계 주인정하기</h3>
<p>기본적으로 rdb에서 두 개체는 FK로 연결되있음</p>
<p>즉 두 테이블에 대해 조회할때 조인으로 합쳐저서 논리적으로 하나의 테이블로 다루게됨</p>
<p>그러나 객체지향적으로 바라보면 각각의 객체는 의존성에 의해 단방향으로 흐르는 관계를 맺음</p>
<p>FK를 기준으로 테이블을 설계하게되면 다대일 관계에서 다에 해당하는 객체는 일에 해당하는 PK를 외래키로 들고있음</p>
<p>따라서 다에 해당하는 객체는 일의 객체로 참조관계를 갖지만 현재 테이블과 매핑된시점에서 일의 객체는 다의 객체로 참조관계를 갖지 못함!</p>
<p>이때 테이블에 반영은 안되지만 논리적으로 조인된 테이블에서 매핑시켜 값을 집어넣을수있는 참조객체LIST를 들고있다면</p>
<p>객체세계에서도 RDB와 같은 양방향 관계를 구현할수 있게됨</p>
<p>그리고 이때, 실제로 FK값을 관리하는 '다’의 객체는 두 객체간의 관계에서 주인이되고</p>
<p>‘일’ 에 해당하는 객체는 ‘mapped by = 다의 속성’ 로 종속됨을 표시해줘야함</p>
<p>Many 쪽이 주인!, FK를 들고있음!, 갱신도 주인만 함! one 쪽이 mapped bh</p>
<h4 id="또한">또한</h4>
<p>DB에 데이터를 집어넣을때 현실적으로 주인과 매핑된 객체 둘다에 저장값을 집어넣는게 영속성 컨텍스트 관리상 옳은 방식이고 객체지향적으로도 양쪽에 데이터값을 모두 기입하는게 옳은 방식이다</p>
<p>그냥 둘다 적어서 저장하도록 하자</p>
<h3 id="일대다-관계-매핑은-추천하지않음">일대다 관계 매핑은 추천하지않음</h3>
<p>외래키는 다 쪽 테이블에 가는 RDB특성상 직관성문제로 코드단위에서 유지보수시 매칭이 되지 않아 헤깔리게됨</p>
<p>참조문제로 일에서 다로 가는경우가 필요하다면</p>
<p>다대일 양방향관계를 쓰는 전략을 사용하는게 남</p>
<h3 id="일대일-관계">일대일 관계</h3>
<p>외래키에 유니크제약조건이 추가된 관계를 의미</p>
<p>어디를 연관관계주인으로 둘지 고민인데</p>
<p>객체지향적으로 많이 조회를 하는쪽에 주인을 두는게 좀더 편리함 DB관점에서는 NULL값을 허용하게되므로 불편하긴함… JPA의 한계 어쩔수없음</p>
<h3 id="다대다-관계">다대다 관계</h3>
<p>사용하지 말고<br>
일대다 조인테이블 다대일로 관계를 맺으며 조인테이블을 조인 객체로 승격시켜서 도메인단위에서 관리하도록 하자</p>
<p>이때 조인테이블의 PK는 전통적인 방식인 양방향 FK -&gt; 슈퍼키로 만들기보단<br>
그냥 비지니스랑 의미없는 UID를 주는것이 더 바람직함(설계의 유연성때문)</p>

