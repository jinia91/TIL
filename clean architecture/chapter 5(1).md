# 아키텍처
> TLDR; 
> 
> 아키텍처 : 시스템을 구축했던 사람들이 만들어낸 시스템의 형태
> 
> 목표 : 시스템의 수명과 관련된 비용은 최소화하고, 프로그래머의 생산성은 최대
> 
> - 따라서 가능한 많은 선택지를 , 가능한 오래동안 남겨두는 전략이 중요
> - 시스템의 의도가 아키텍처수준에서 드러나야 유지보수에 용이

- 아키텍처는 성능이나 행위를 제대로 하기위해 선택되는것이 아님
- 이러한 아키텍처도 존재는 하지만 어디까지나 요구사항에 의해 한정되고 피동적으로 정해지는 시스템 아키텍처에 불과함
- 오히려 아키텍트가 정의하는 능동적인 아키텍처는 애플리케이션, 시스템의 생명주기를 지원하기위함

## 생명주기와 아키텍처
- 개발 : 아키텍처는 개발팀이 시스템을 쉽게 개발할수 있도록 뒷받침
- 배포 : 시스템이 쉽게 배포할 수 있도록 목표로
- 운영 : 아키텍처와는 크게 밀접하지는 않음, 다만 서비스 중심의 아키텍처(SOA, DDD)는 시스템의 이해를 쉽게하며 장기적으론 운영에도 도움됨
- 유지보수 : 소프트웨어 시스템에서 가장 비용이 많이 드는 부분!

## 헥심은 유지보수다!

- 소스코드 분석, 요구사항 이해 이른바 탐사`spelunking`은 유지보수의 핵심이자 아키텍처가 최고로 관심가져야 할 사항
- 탐사하기 쉬운 아키텍처란 무엇인가?


> 중요한것과 덜 중요한것으로 나누기가 핵심!

덜 중요한것은 최대한 선택을 늦추는 방향으로 설계하면 변경에 더 유연해진다!

## 좋은 아키텍처가 되기 위해서는 그럼 어떻게 해야하지?

- 선택사항을 열어둬야하고
- 시스템의 의도가 아키텍처 수준에 드러나야하고
- 그럼에도 모든 유즈케이스를 알지 못하며, 변경될 유즈케이스 추가될 유즈케이스를 예측할수 없기 떄문에
- 최대한 동일한 이유로 변경될만한것들을 묶는것이 바람직하다

=> 동일한 이유로 변경될만한것들은 결국 응집도를 가진것들이고 이는 여러 레이어를 수직으로 관통하는 한 부분! == 도메인

- 서로 다른 이유 서로 다른 속도로 변경될수 있는것들은 분리해야함이 바람직

![image](https://user-images.githubusercontent.com/85499582/216936745-70c8639c-b315-4e57-9493-c30def6579fc.png)

이렇게 유스케이스의 큰 범위로 쪼개지는것이 바로 (비즈니스 목적으로 쪼개진) 서비스 컴포넌트이며 마이크로 서비스!

> Service-Oriented Architecture(SOA)

## 그럼 MSA가 무조건인가?
- MSA는 이론적으로 서로 다른 이유로 독립적으로 발전하고 다른 속도로 변화할 유즈케이스들을 묶고
- 배포의 독립성과
- 개발 독립성을 보장함

### 현실은...

- 하지만 외부 리소스의 가용정도를 고려하는게 훨씬 중요하다!
  - 돈이 문제!
- 변화하지 않을수도 있다
  - 변화는 결국 많은 수요와 그곳에서 파생되는 추가 요구사항떄문
  - 수요가 없다면...
  - 또는 판단을 잘못해서 변화가 정말 없는도메인이라면

## 그럼 서비스 컴포넌트는 어느수준으로 쪼개야하나...?
- 스레드레벨 : 단순히 하나의 프로세스에 클래스 단위, 인스턴스 단위로 쪼개는것
  - 구현은 쉽지만, 사실 그렇게 좋은방법은아니다
  - 너무 느슨한 컨벤션과 깨진 유리창이 될 확률이 높기때문
- 배포형 컴포넌트 수준: jar같은 모듈단위 
  - 애플리케이션 안에 존재하되 모듈단위로 쪼개지므로 배포과정의 차이만 존재할 뿐 런타임시점에는 컴포넌트 단일체와 동일
  - 현실적으로 가장 바람직하지 않을가
- 로컬 프로세스 : 한 애플리케이션(프로그램)이 여러 로컬프로세스를 포함, 운영체제의 통신수단에 의존하는경우가 대부분
  - 사실상 별개의 앱을 한 로컬에 띄우는것으로 오히려 소통 방식을 제대로 추상화시키지않았다면 추후 다른 머신으로 분리될때 더 안좋을수도...?
  - 최소한 웹서버 구축시엔 보기 어려운 구조일듯?
- 서비스 서버 
  - MSA
  - 소통비용


## 결론

- 좋은 아키텍처는 시스템이 모노리틱 구조로 태어나 단일 파일로 배포되더라도, 이후에는 독립적으로 배포 가능한 단위들의 집합으로 성장하고, 또 독립적인 서비스나 마이크로서비스 수준까지 성장할 수 있도록 만들어져야 한다.
- 좋은 아키텍처라면 나중에 상황이 바뀌었을 때엔 다시 원래 형태인 모노리틱 구조로 되돌릴 수도 있어야 함.
- 좋은 아키텍처는 “결합 분리 모드(시간이 지남에 따라 바뀌기 쉬움)”를 선택사항으로 남겨두어, 배포 규모에 따라 적합한 모드를 선택할 수 있게 함.
- 결합 분리 모드는 플러그인화시킬것!





