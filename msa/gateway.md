# gateway

## gateway의 필요성

- msa로 서비스가 분할되어있다고 가정할때, 클라이언트는 각각의 모든 서비스 인스턴스를 알고 엔드포인트를 알아야할까?
- 클라이언트를 기억하기위해 각각의 서비스가 인증인가를 해야 할까?
- 클라이언트가 특정 유즈케이스를 달성하기 위해 모든 분할된 서비스들을 호출하는 순서를 알고있다면, 비즈니스 로직의 노출이나 다름없다!

![image](https://user-images.githubusercontent.com/85499582/188876618-e5099e85-cd79-4875-9aeb-5d85a7abb9fd.png)

## gateway란
> 서버들의 최 앞단에서 엔드포인트를 단일화해주는 또다른 서버

일반적으로 api에 대한 인증 인가 기능을 동반하며, 메세지의 내용에 따라  어플리케이션 내부에 있는 마이크로 서비스로 라우팅하는 역할을 담당


##주요 기능

### 인증 및 인가
- 인증서 관리나, 인증, SSL, 프로토콜 변환과 같은 기능들은 API Gateway에서 오프로드

### 요청 절차의 단순화
- 클라이언트는 하나의 엔드 포인트만 알면 됨
- 게이트웨이에서 오케스트레이션을 통해 마이크로 서비스들을 호출하고 조합할 수 있음

### 서비스 오케스트레이션
- 과도한 오케스트레이션은 게이트웨이의 비대화, monolith한 서버를 다시 만드는꼴이되므로 적절한 오케스트레이션 조율이 필요

### 라우팅, 로드밸런싱, 디스커버리
로드밸런싱을 통한 수평확장, 서비스 디스커버리를 통한 서비스 위치 파악과 라우팅

### 응답 캐싱
- 간단한 호출의 경우 캐싱으로 처리 가능

### 일괄정책, 서킷브레이커 패턴 적용 가능

### 로깅 추적, 상관관계 분석에 용이

### IP 허용 차단도 가능, 프록시로서의 역할, 방화벽역할도 가능

# 게이트웨이 구현체

## 넷플릭스 리본(Ribbon)
- 넷플릭스에서 만든 L7 로드밸런서 오픈소스

![image](https://user-images.githubusercontent.com/85499582/188879156-8784de46-8629-4930-a247-d86adc6f832d.png)

- 클라이언트인 게이트웨이에 탑재시켜 사용하는셈
- 로드밸런서 하드웨어없이 소프트웨어 차원에서 라우팅!
- 헬스체크
- 단점 : 비동기화 처리가 힘듬
  - 스프링부트 2.4 기준 maintanance 상태, 곧 deprecated 될듯

## 넷플릭스 줄(Zuul)
- 게이트 웨이 역할
- 스프링부트 2.4 기준 maintanance 상태, 곧 deprecated 될듯
 

## 스프링클라우드 게이트웨이(스프링부트 2.4 이전)
- 넷플릭스 줄과 넷플릭스 리본을 사용해서 구현

## 스프링 클라우드 게이트웨이(스프링부트 2.4 이후)
- 스프링클라우드 게이트웨이와 스프링클라우드 로드밸런서 로 
